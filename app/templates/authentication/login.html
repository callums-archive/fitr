{% extends  'base/layout.html'%}

{% block styles %}
<style>
    img {
        font-size: 1.125rem;
        text-anchor: middle;
    }

    ::-webkit-input-placeholder {
        text-align: center;
    }

    :-moz-placeholder { /* Firefox 18- */
        text-align: center;
    }

    ::-moz-placeholder {  /* Firefox 19+ */
        text-align: center;
    }

    :-ms-input-placeholder {
        text-align: center;
    }
</style>
{% endblock styles %}

{% block content %}
<div class="d-flex justify-content-center" style="height: 100%;">
    <div class="d-flex align-items-center" style="max-width: 80%;">
        <form id="login">
            <div class="d-flex justify-content-center">
                <img class="mb-3" src="{{ url_for('static', filename='images/logo.png') }}" alt="" height="75">
            </div>

            <div class="form-group">
                <input type="text" class="form-control form-control-lg" name="identifier" placeholder="Username / Email" required>
            </div>

            <div class="form-group">
                <input type="password" class="form-control form-control-lg" name="password" placeholder="Password" required>
            </div>

            <button type="submit" class="mt-3 mb-3 btn btn-lg btn-primary btn-block">Sign in</button>

            <hr>

            <p class="mt-1 text-muted float-left">&copy; <script>document.write(new Date().getFullYear())</script></p>
            <a class="mt-1 float-right btn btn-sm btn-secondary" href="{{ url_for('UserRegistrationView:register_get') }}"><b><i class="fas fa-info-circle"></i> Need an account?</b></a>
        </form>
    </div>
</div>

{% endblock content %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function(e) {
    FormValidation.formValidation(
        document.getElementById('login'),
        {
            fields: {
                identifier: {
                    validators: {
                        notEmpty: {
                            message: 'field is required'
                        },
                        stringLength: {
                            min: 3,
                            max: 30,
                            message: 'Field must be between 3 and 30 characters'
                        }
                    }
                },
                password: {
                    validators: {
                        notEmpty: {
                            message: 'field is required'
                        }
                    }
                },
            },
            plugins: {
                trigger: new FormValidation.plugins.Trigger(),
                bootstrap: new FormValidation.plugins.Bootstrap(),
                submitButton: new FormValidation.plugins.SubmitButton(),
            },
        }
    ).on('core.form.valid', function() {
        $.ajax({
          accept: 'application/json',
          contentType: 'application/json',
          type: "POST",
          url: "{{ url_for('UserAuthenticationView:login_post') }}",
          data: $('#login').jsonString()
        }).done(function(data, status, jqXHR) {
          window.location.replace(data.redirect);
        }).fail(function(data, status, jqXHR) {
            try {
                var error = data.responseJSON.error_msg;
            } catch (err) {
                var error = "Server Error, Try again.";
            }

            $.toast({
                text: error,
                heading: 'Error!',
                icon: 'error',
                showHideTransition: 'slide',
                allowToastClose: false,
                hideAfter: 3000,
                stack: 5,
                position: 'top-center',
                textAlign: 'left',
                loader: true,
                beforeShow: function () {},
                afterShown: function () {},
                beforeHide: function () {},
                afterHidden: function () {}
            });
        });
    });
});
</script>
{% endblock scripts %}
