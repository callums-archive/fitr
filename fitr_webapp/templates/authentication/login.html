{% extends  'base/layout.html'%}

{% block styles %}
<style>
  .form-width {
    width: 400px !important;
    margin: auto;
  }

  .valign-wrapper {
    height: 90% !important;
  }
</style>
{% endblock styles %}

{% block content %}

<nav>
  <div class="nav-wrapper {{ colours['nav'] }}">
    <a href="{{ url_for('index') }}" class="left brand-logo">
      <img class="center-align" src="{{ url_for('static', filename='images/logo_white.png') }}" alt="">
    </a>
    <ul class="right">
      <li><a class="btn {{ colours['secondary_btn'] }}" href="{{ url_for('UserRegistrationView:register_get') }}"><i class="fas fa-user-plus"></i> Register</a></li>
    </ul>
  </div>
</nav>

<div class="valign-wrapper">
  <div class="form-width">
    <div class="row">

      <div class="col s12">
        <h5 class="center-align"><i class="far fa-user"></i> Login</h5>
      </div>

      <div class="col s12 mobile-form">
        <div class="card-panel {{ colours['primary_card'] }} mt-4">
          <form id="login">

            <div class="row mb-0">
              <button class="col s12 btn btn-large {{ colours['primary_btn'] }} modal-trigger" type="submit">Login</button>
              <div class="col s12 mt-4 center-align">
                <a class="black-text text-lighten-3" href="./forgot">Forgot password?</a>
              </div>
            </div>

          </form>
        </div>
      </div>

      <div class="col s12">
        <p class="mt-4 center-align text-darken-2">&copy; <script>
            document.write(new Date().getFullYear())
          </script>
        </p>
      </div>
    </div>
  </div>
</div>

{% endblock content %}

{% block scripts %}
<script>
  $(document).ready(function() {
    decide_form_card(".mobile-form");

    new formGen("#login", {
      form: [{
          type: "string",
          name: "identifier",
          placeholder: "Username/Email",
          validators: ["strMin(5)"]
        },
        {
          type: "password",
          name: "password",
          placeholder: "Password",
          validators: ["notEmpty()"]
        },
      ],

      remote: {
        submit: {
          method: "POST",
          url: "{{ url_for('UserAuthenticationView:login_post') }}"
        },
      },

      onSuccess(data, status, xhr) {
        window.location.replace(data.redirect)
      },

      onFail(xhr, status) {
        try {
          var error = xhr.responseJSON.error_msg;
        } catch (err) {
          var error = "Server Error, Try again.";
        }
        M.toast({html: error});
      }
    });
  });
</script>
{% endblock scripts %}
